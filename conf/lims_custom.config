profiles {
    lims {
        // Manage java memory usage
        env.NXF_OPTS = "-Xms500M -Xmx2G"
        env.NXF_WORK = '/tmp'
        params {
            max_memory = 396.GB
            max_cpus = 96
            max_time = '24.h'
        }
        executor {
                name              = 'slurm'
                queueSize         = 10
                pollInterval      = '30 sec'
                killBatchSize     = 30
                submitRateLimit   = '10 min'
            }
        process {
            time = { check_max( 1.h   * task.attempt, 'time'    ) }
            queue = 'day'
            withLabel:process_low {
                // cpus   = { check_max( 2     * task.attempt, 'cpus'    ) }
                // memory = { check_max( 12.GB * task.attempt, 'memory'  ) }
                time   = { check_max( 1.h   * task.attempt, 'time'    ) }
                queue = 'short'
            }
            withLabel:process_medium {
                // cpus   = { check_max( 6     * task.attempt, 'cpus'    ) }
                // memory = { check_max( 36.GB * task.attempt, 'memory'  ) }
                time   = { check_max( 8.h   * task.attempt, 'time'    ) }
                queue = 'day'
            }
            withLabel:process_high {
                // cpus   = { check_max( 12    * task.attempt, 'cpus'    ) }
                // memory = { check_max( 72.GB * task.attempt, 'memory'  ) }
                time   = { check_max( 8.h  * task.attempt, 'time'    ) }
                queue = 'day'
            }
            withLabel:process_long {
                time   = { check_max( 20.h  * task.attempt, 'time'    ) }
                queue = 'day'
            }
        }
    }
    modules {
        process {
            // Module loading
            withName: SAMPLESHEET_CHECK                          { module = 'python-gcc7/3.6.8'                 }
            withName: GET_SOFTWARE_VERSIONS                      { module = 'python-gcc7/3.6.8'                 }
            withName: FASTQC                                     { module = 'fastqc/0.11.9'                     }
            withName: MULTIQC                                    { module = 'multiqc/1.9'                       }
            withName: TRIMGALORE                                 { module = 'trimgalore/0.6.3'                  }
            withName: HISAT2_ALIGN                               { module = 'hisat-gcc/2.1.0:samtools-gcc7/1.9' }
            withName: 'HISAT2_BUILD||HISAT2_EXTRACTSPLICESITES'  { module = 'hisat-gcc/2.1.0'                   }
            withName: 'SAMTOOLS_.*'                              { module = 'samtools-gcc7/1.9'                 }
            withName: SUBREAD_FEATURECOUNTS                      { module = 'subread-gcc/1.6.0'                 }
            withName: 'STRINGTIE*'                               { module = 'stringtie-gcc/1.3.5'               }
            withName: COLLATE_TPM                                { module = 'python-gcc7/3.6.8'                 }
            // Lower max time for favourable slurm priority
        }
    }
}